{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>Mi Biblioteca</h2>
    <p>Gestiona tus juegos, actualizalos y calificalos.</p>

    <table>
        <thead>
            <tr>
                <th>Juego</th>
                <th>Plataforma</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for juego in juegos %}
            <tr>
                <td>{{ juego.titulo }}</td>
                <td>{{ juego.plataforma }}</td>
                <td>
                    <form method="POST" action="/library/play" style="display:inline;">
                        <input type="hidden" name="juego" value="{{ juego.titulo }}">
                        <button type="submit" style="margin:0; padding:5px 10px; font-size:12px; background-color:#27ae60;">Jugar (Simular)</button>
                    </form>
                    <form method="POST" action="/library/update" style="display:inline;">
                        <input type="hidden" name="juego" value="{{ juego.titulo }}">
                        <button type="submit" style="margin:0; padding:5px 10px; font-size:12px;">Actualizar</button>
                    </form>
                    <button onclick="mostrarCalificar('{{ juego.titulo }}')" style="margin:0; padding:5px 10px; font-size:12px; background-color:#3498db;">Calificar</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if logs_juego %}
    <div class="result-box" style="background-color: #2c3e50; color: #ecf0f1; border: 1px solid #34495e;">
        <h3>Sesion de Juego: {{ juego_jugado }}</h3>
        <ul>
            {% for log in logs_juego %}
            <li>{{ log }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if mensaje %}
    <div class="result-box">
        {{ mensaje }}
    </div>
    {% endif %}

    {% if logros %}
    <div class="card" style="margin-top: 30px;">
        <h3>üèÜ Tus Logros Desbloqueados</h3>
        <div class="items-grid">
            {% for logro in logros %}
            <div class="item-card" style="border-color: #f1c40f;">
                <h4 style="color: #f39c12;">{{ logro.name }}</h4>
                <p><strong>Juego:</strong> {{ logro.game_title }}</p>
                <p><small>{{ logro.description }}</small></p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<div id="calificarModal" class="card" style="display:none; margin-top:20px; border: 2px solid #3498db;">
    <h3>Calificar <span id="modalJuegoTitulo"></span></h3>
    <form method="POST" action="/library/rate">
        <input type="hidden" id="rateJuego" name="juego">
        <!-- Usuario se toma de la sesion -->
        <label>Puntuacion (1-5):</label>
        <select name="puntuacion" required>
            <option value="5">5 - Excelente</option>
            <option value="4">4 - Bueno</option>
            <option value="3">3 - Regular</option>
            <option value="2">2 - Malo</option>
            <option value="1">1 - Terrible</option>
        </select>
        <label>Comentario:</label>
        <input type="text" name="comentario" placeholder="Escribe tu opinion...">
        <button type="submit">Enviar Calificacion</button>
        <button type="button" onclick="document.getElementById('calificarModal').style.display='none'" class="btn-cancel">Cancelar</button>
    </form>
</div>

<script>
function mostrarCalificar(titulo) {
    document.getElementById('calificarModal').style.display = 'block';
    document.getElementById('modalJuegoTitulo').innerText = titulo;
    document.getElementById('rateJuego').value = titulo;
}
</script>
{% endblock %}
